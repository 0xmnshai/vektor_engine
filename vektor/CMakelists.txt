cmake_minimum_required(VERSION 3.17)
project(vektor)

include(FetchContent)

FetchContent_Declare(
    spdlog
    GIT_REPOSITORY https://github.com/gabime/spdlog.git
    GIT_TAG v1.17.0
)

FetchContent_GetProperties(spdlog)

if(NOT spdlog_POPULATED)
    FetchContent_MakeAvailable(spdlog)
    message(STATUS " [Vektor] spdlog downloaded and configured.")
else()
    FetchContent_MakeAvailable(spdlog)
    message(STATUS " [Vektor] spdlog found in cache. Skipping download.")
endif()

FetchContent_Declare(
    imgui
    GIT_REPOSITORY https://github.com/ocornut/imgui.git

    # GIT_TAG v1.92.5
    GIT_TAG docking
)

FetchContent_GetProperties(imgui)

if(NOT imgui_POPULATED)
    FetchContent_MakeAvailable(imgui)
    message(STATUS " [Vektor] imgui downloaded and configured.")
else()
    FetchContent_MakeAvailable(imgui)
    message(STATUS " [Vektor] imgui found in cache. Skipping download.")
endif()

add_library(imgui STATIC
    ${imgui_SOURCE_DIR}/imgui.cpp
    ${imgui_SOURCE_DIR}/imgui_demo.cpp
    ${imgui_SOURCE_DIR}/imgui_draw.cpp
    ${imgui_SOURCE_DIR}/imgui_tables.cpp
    ${imgui_SOURCE_DIR}/imgui_widgets.cpp
)

target_include_directories(imgui PUBLIC
    ${imgui_SOURCE_DIR}
)

FetchContent_Declare(
    glfw
    GIT_REPOSITORY https://github.com/glfw/glfw.git
    GIT_TAG 3.4
)

set(GLFW_BUILD_DOCS OFF CACHE BOOL "" FORCE)
set(GLFW_BUILD_TESTS OFF CACHE BOOL "" FORCE)
set(GLFW_BUILD_EXAMPLES OFF CACHE BOOL "" FORCE)
set(GLFW_INSTALL OFF CACHE BOOL "" FORCE)

FetchContent_GetProperties(glfw)

if(NOT glfw_POPULATED)
    FetchContent_MakeAvailable(glfw)
    message(STATUS " [Vektor] glfw downloaded and configured.")
else()
    FetchContent_MakeAvailable(glfw)
    message(STATUS " [Vektor] glfw found in cache. Skipping download.")
endif()

add_library(glad STATIC
    "${CMAKE_CURRENT_SOURCE_DIR}/vendor/glad/src/glad.c"
)

target_include_directories(glad PUBLIC
    "${CMAKE_CURRENT_SOURCE_DIR}/vendor/glad/include"
)

FetchContent_Declare(
    glm
    GIT_REPOSITORY https://github.com/g-truc/glm.git
    GIT_TAG 1.0.3
)

FetchContent_GetProperties(glm)

if(NOT glm_POPULATED)
    FetchContent_MakeAvailable(glm)
    message(STATUS " [Vektor] glm downloaded and configured.")
else()
    FetchContent_MakeAvailable(glm)
    message(STATUS " [Vektor] glm found in cache. Skipping download.")
endif()

FetchContent_Declare(
    stb
    GIT_REPOSITORY https://github.com/nothings/stb.git
    GIT_TAG master
)
FetchContent_GetProperties(stb)

if(NOT stb_POPULATED)
    FetchContent_MakeAvailable(stb)
    message(STATUS " [Vektor] stb downloaded and configured.")
else()
    FetchContent_MakeAvailable(stb)
    message(STATUS " [Vektor] stb found in cache. Skipping download.")
endif()

file(GLOB_RECURSE SOURCES
    "src/*.cpp"
    "include/*.hpp"
)

add_library(vektor SHARED ${SOURCES})

target_sources(imgui PRIVATE
    ${imgui_SOURCE_DIR}/backends/imgui_impl_glfw.cpp
    ${imgui_SOURCE_DIR}/backends/imgui_impl_opengl3.cpp
)

target_include_directories(imgui PUBLIC
    ${imgui_SOURCE_DIR}/backends
)

target_link_libraries(imgui PUBLIC
    glfw
    glad
)

target_include_directories(vektor PUBLIC
    ${CMAKE_CURRENT_SOURCE_DIR}/include
)

target_include_directories(vektor PRIVATE
    ${stb_SOURCE_DIR}
)

target_link_libraries(vektor PUBLIC
    spdlog::spdlog
    glfw
    imgui
    glad
    glm
)

target_compile_definitions(vektor PRIVATE
    VEKTOR_BUILD_DLL
    GL_SILENCE_DEPRECATION
)

if(UNIX)
    target_link_libraries(vektor PRIVATE ${CMAKE_DL_LIBS})
endif()

if(APPLE)
    target_link_libraries(vektor PRIVATE
        "-framework Cocoa"
        "-framework IOKit"
        "-framework CoreVideo"
        "-framework OpenGL"
    )
endif()